# üìò OptiFlow Core v3.3 ‚Äì –§–∏–Ω–∞–ª—å–Ω—ã–π Fix Audit + –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ + –°—Ç—Ä–∞—Ç–µ–≥–∏—è

–§–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å—ë: —Ü–µ–ª–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, —Ñ–∏–∫—Å—ã, —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ **OptiFlow Core** (v3.3, –ò—é–Ω—å 2025).

---

## üöÄ –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏ —Ü–µ–ª–∏

### üìà –¶–µ–ª—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ $225‚Äì250 –¥–∞—ë—Ç $3‚Äì5/—á–∞—Å –ø—Ä–∏–±—ã–ª–∏, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ runtime-–∫–æ–Ω—Ñ–∏–≥–∏.

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏—á–∏:

-   Stepwise TP1/TP2/TP3 (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —É—Ä–æ–≤–Ω–∏, runtime-driven)
-   SL –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR + trailing + break-even
-   –°–∏–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã —á–µ—Ä–µ–∑ MACD/EMA/RSI/volume —Ñ–∏–ª—å—Ç—Ä—ã
-   Signal Score –ª–æ–≥–∏–∫–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –∞–Ω–∞–ª–∏–∑–æ–º –∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
-   –ê–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TP —É—Ä–æ–≤–Ω–µ–π —á–µ—Ä–µ–∑ TP-—Ö–∏—Ç—ã
-   Telegram-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –∫–æ–º–∞–Ω–¥—ã, –ª–æ–≥–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è TP/SL
-   ENV-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∑–∞–ø—É—Å–∫–æ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–æ—Ç–æ–≤
-   –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç: anti-reentry, SL-streak pause, capital utilization limit, timeout exit

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏

| –ú–æ–¥—É–ª—å                         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                   |
| ------------------------------ | ---------------------------------------------------------------------------- |
| `main.py`                      | –ó–∞–ø—É—Å–∫, restore, Telegram init, runtime-config, –ª–æ–≥–∏–∫–∞ init                  |
| `should_enter_trade(...)`      | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞, —Ñ–∏–ª—å—Ç—Ä—ã MACD/RSI/HTF, signal_score, min_profit            |
| `enter_trade(...)`             | –í—Ö–æ–¥ –≤ —Å–¥–µ–ª–∫—É, risk/qty —Ä–∞—Å—á—ë—Ç, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤, Telegram –ª–æ–≥–∏–∫–∞            |
| `monitor_active_position(...)` | TP-touch –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, fallback, break-even SL, soft_exit, trailing_tp         |
| `record_trade_result(...)`     | –§–∏–Ω–∞–ª—å–Ω—ã–π –ª–æ–≥, PnL, SL, trailing, Telegram –æ—Ç—á—ë—Ç, update TP logic            |
| `log_trade_result(...)`        | CSV –ª–æ–≥ —Å 19 –ø–æ–ª—è–º–∏, TP1/2 hits, result, net/abs profit, signal_score        |
| `entry_logger.py`              | –ó–∞–ø–∏—Å—å –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ —Å expected_profit, commission, TP-—Ü–µ–Ω–∞–º–∏, score         |
| `tp_logger.py`                 | CSV –ª–æ–≥–∏–∫–∞, today PnL, get_trade_stats(), signal_score                       |
| `tp_optimizer.py`              | –ê–≤—Ç–æ–∞–Ω–∞–ª–∏–∑ TP1/TP2 —Ö–∏—Ç–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ TP —É—Ä–æ–≤–Ω–µ–π –≤ runtime_config.json         |
| `telegram_commands.py`         | –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: /summary, /goal, /pnl_today, /runtime –∏ –¥—Ä. |

---

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤

### üîπ –ë–ª–æ–∫ 1: –°–∏–≥–Ω–∞–ª—ã –∏ –≤—Ö–æ–¥—ã

-   `signal_score` –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–æ–≤ MACD/RSI/EMA
-   `passes_1plus1(...)` ‚Äî strict —Ä–µ–∂–∏–º, min_primary = 2, min_secondary = 1
-   –§–∏–ª—å—Ç—Ä—ã: `min_macd_strength = 0.002`, `min_rsi_strength = 12.0`
-   –ü—Ä–æ–≤–µ—Ä–∫–∞ HTF: –Ω–µ —à–æ—Ä—Ç–∏–º –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞ (HTF < 1)
-   `min_profit_threshold` –∏ expected_profit —Ñ–∏–ª—å—Ç—Ä
-   Anti-reentry, cooldown, SL streak auto-pause

### üîπ –ë–ª–æ–∫ 2: TP/SL –∏ –ª–æ–≥–∏–∫–∞ –≤—ã—Ö–æ–¥–∞

-   Step TP: `[0.02, 0.04, 0.06]` + `[0.5, 0.3, 0.2]`
-   TP-touch –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, fallback —á–µ—Ä–µ–∑ 5 —Å–µ–∫
-   Break-even SL –ø—Ä–∏ +1.0% –∏–ª–∏ TP1-hit
-   Soft-exit —á–µ—Ä–µ–∑ 10 –º–∏–Ω, –µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å ‚â• $0.10 (–∏–ª–∏ ‚â• 0 –ø—Ä–∏ allow_at_zero)
-   Timeout –ø–æ `max_hold_minutes` = 45

### üîπ –ë–ª–æ–∫ 3: –†–∏—Å–∫ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

-   calculate_position_size(...):

    -   —É—á–∏—Ç—ã–≤–∞–µ—Ç SL, leverage, margin, capital utilization
    -   –∞–≤—Ç–æ-—Ä–µ–¥—É–∫—Ü–∏—è (`auto_reduce_entry_if_risk_exceeds = true`)
    -   `min_trade_qty`, `MIN_NOTIONAL_OPEN` —É—á—Ç–µ–Ω—ã

-   check_entry_allowed(...): max_concurrent_positions, capital used

-   runtime_config: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∫–æ–¥–µ, –≤–∫–ª—é—á–∞—è step_tp, capital_pct, base_risk_pct

### üîπ –ë–ª–æ–∫ 4: Telegram –∏ –∫–æ–º–∞–Ω–¥—ã

-   –ü–æ–ª–Ω—ã–π UI: /summary, /pnl_today, /goal, /runtime, /riskstatus, /debugpanel –∏ –¥—Ä.
-   Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
    -   TP1/TP2-hit, fallback, soft_exit, stop, invalid qty, missed signals with score > 0.85

### üîπ –ë–ª–æ–∫ 5: TP-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è

-   evaluate_best_config(...) ‚Üí –ø–æ–¥—Å—á—ë—Ç TP1/2/SL hits, auto-update config
-   Telegram –æ—Ç—á—ë—Ç –ø–æ TP-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: —Å—Ç–∞—Ä–∞—è/–Ω–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
-   tp_logger ‚Üí 19 –ø–æ–ª–µ–π, –≤–∫–ª—é—á–∞—è signal_score, TP1/2/SL, result, PnL, ATR

---

## üîß –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ñ–∏–∫—Å—ã OptiFlow v3.3

-   Qty rounding —á–µ—Ä–µ–∑ step_size, min_trade_qty –∑–∞—â–∏—Ç–∞
-   –ê–≤—Ç–æ-—Ä–µ–¥—É–∫—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∫–∞–ø–∏—Ç–∞–ª–∞
-   –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ª–æ–≥–∞–º–∏: log_entry, record_trade_result, log_missed_signal
-   `signal_score` –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤–µ–∑–¥–µ, –≤–∫–ª—é—á–∞—è Telegram
-   –ò—Å–∫–ª—é—á–µ–Ω—ã –æ—à–∏–±–∫–∏ filled_qty=0, TP –Ω–µ —Å—Ç–∞–≤–∏—Ç—Å—è, SL –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
-   –£–ª—É—á—à–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤, qty_blocked –∏ low_volume –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ

---

## üîö –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: OptiFlow Core v3.3 ‚úÖ

–ë–æ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–∞–±–∏–ª–µ–Ω**, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –∑–∞–≤–µ—Ä—à—ë–Ω:

-   –í—Å–µ —Å–¥–µ–ª–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ–ª–Ω—ã–π —Å–∏–≥–Ω–∞–ª ‚Üí –≤—Ö–æ–¥ ‚Üí TP/SL ‚Üí –ª–æ–≥ —Ü–µ–ø–æ—á–∫—É
-   –ó–∞—â–∏—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç: min_qty, capital limit, fallback, TP-touch, SL streak pause
-   Telegram –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Å—Ç–∞–¥–∏–∏: —Å–∏–≥–Ω–∞–ª, –≤—Ö–æ–¥, –≤—ã—Ö–æ–¥, missed, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
-   TP-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏–∫–∞ PnL —Ä–∞–±–æ—Ç–∞—é—Ç
-   –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–º—É–ª—å—Ç–∏–±–æ—Ç—ã, TradingView, funding rate –∏ —Ç.–¥.)
