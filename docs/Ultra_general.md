# üìò OptiFlow Core v3.1 ‚Äì –§–∏–Ω–∞–ª—å–Ω—ã–π Fix Audit + –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ + –°—Ç—Ä–∞—Ç–µ–≥–∏—è

–§–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å—ë: —Ü–µ–ª–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, —Ñ–∏–∫—Å—ã, —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ **OptiFlow Core** (v3.1, –ò—é–Ω—å 2025).

---

## üöÄ –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏ —Ü–µ–ª–∏

### üìà –¶–µ–ª—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ \$225‚Äì250 –¥–∞—ë—Ç \$3‚Äì5/—á–∞—Å –ø—Ä–∏–±—ã–ª–∏, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ runtime-–∫–æ–Ω—Ñ–∏–≥–∏.

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏—á–∏:

-   Stepwise TP1/TP2/TP3 (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —É—Ä–æ–≤–Ω–∏, runtime-driven)
-   SL –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR + trailing + break-even
-   –°–∏–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã —á–µ—Ä–µ–∑ MACD/EMA/RSI/volume —Ñ–∏–ª—å—Ç—Ä—ã
-   –ê–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TP —É—Ä–æ–≤–Ω–µ–π —á–µ—Ä–µ–∑ TP-—Ö–∏—Ç—ã
-   Telegram-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –∫–æ–º–∞–Ω–¥—ã, –ª–æ–≥–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è TP/SL
-   ENV-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∑–∞–ø—É—Å–∫–æ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–æ—Ç–æ–≤
-   –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç: anti-reentry, SL-streak pause, capital utilization limit, timeout exit

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏

| –ú–æ–¥—É–ª—å                         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                   |
| ------------------------------ | ---------------------------------------------------------------------------- |
| `main.py`                      | –ó–∞–ø—É—Å–∫, restore, Telegram init, runtime-config, –ª–æ–≥–∏–∫–∞ init                  |
| `should_enter_trade(...)`      | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞, —Ñ–∏–ª—å—Ç—Ä—ã MACD/RSI/HTF, passes_1plus1, min_profit           |
| `enter_trade(...)`             | –í—Ö–æ–¥ –≤ —Å–¥–µ–ª–∫—É, risk/qty —Ä–∞—Å—á—ë—Ç, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤, Telegram –ª–æ–≥–∏–∫–∞            |
| `monitor_active_position(...)` | TP-touch –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, fallback, break-even SL, soft_exit, trailing_tp         |
| `record_trade_result(...)`     | –§–∏–Ω–∞–ª—å–Ω—ã–π –ª–æ–≥, PnL, SL, trailing, Telegram –æ—Ç—á—ë—Ç, update TP logic            |
| `log_trade_result(...)`        | CSV –ª–æ–≥ —Å 18 –ø–æ–ª—è–º–∏, TP1/2 hits, result, net/abs profit                      |
| `entry_logger.py`              | –ó–∞–ø–∏—Å—å –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ —Å expected_profit, commission, TP-—Ü–µ–Ω–∞–º–∏                |
| `tp_logger.py`                 | CSV –ª–æ–≥–∏–∫–∞, today PnL, get_trade_stats()                                     |
| `tp_optimizer.py`              | –ê–≤—Ç–æ–∞–Ω–∞–ª–∏–∑ TP1/TP2 —Ö–∏—Ç–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ TP —É—Ä–æ–≤–Ω–µ–π –≤ runtime_config.json         |
| `telegram_commands.py`         | –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: /summary, /goal, /pnl_today, /runtime –∏ –¥—Ä. |

---

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤

### üîπ –ë–ª–æ–∫ 1: –°–∏–≥–Ω–∞–ª—ã –∏ –≤—Ö–æ–¥—ã

-   `passes_1plus1(...)` ‚Äî strict —Ä–µ–∂–∏–º, min_primary = 2, min_secondary = 1
-   `min_macd_strength = 0.002`, `min_rsi_strength = 12.0`
-   –ü—Ä–æ–≤–µ—Ä–∫–∞ HTF: –Ω–µ —à–æ—Ä—Ç–∏–º –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–Ω–¥–∞ (HTF < 1)
-   –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `expected_profit`, min_profit_threshold (–Ω–∞–ø—Ä–∏–º–µ—Ä, \$0.06)
-   Anti-reentry —á–µ—Ä–µ–∑ `last_trade_times`
-   Daily SL streak ‚Üí auto-pause –Ω–∞ 15 –º–∏–Ω –ø—Ä–∏ 3 —É–±—ã—Ç–∫–∞—Ö

### üîπ –ë–ª–æ–∫ 2: TP/SL –∏ –ª–æ–≥–∏–∫–∞ –≤—ã—Ö–æ–¥–∞

-   Step TP: `[0.02, 0.04, 0.06]` + `[0.5, 0.3, 0.2]`
-   TP-touch monitor (–µ—Å–ª–∏ TP –Ω–µ fill'd ‚Üí fallback —á–µ—Ä–µ–∑ 5 —Å–µ–∫)
-   Break-even SL –ø—Ä–∏ +1.0% –∏–ª–∏ TP1-hit
-   Soft-exit —á–µ—Ä–µ–∑ 10 –º–∏–Ω, –µ—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å ‚â• \$0.10 (–∏–ª–∏ ‚â• 0, –µ—Å–ª–∏ allow_at_zero)
-   Timeout –ø–æ `max_hold_minutes` = 45
-   minimum_step_profit_hit_required = true

### üîπ –ë–ª–æ–∫ 3: –†–∏—Å–∫ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

-   calculate_position_size(...) —É—á–∏—Ç—ã–≤–∞–µ—Ç:

    -   SL, leverage, margin, max_notional, min_qty

-   Capital utilization limit ‚â§ 80%
-   –ü—Ä–æ–≤–µ—Ä–∫–∞ `check_entry_allowed(...)` –Ω–∞ max concurrent positions –∏ hourly limit
-   runtime_config –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `risk_multiplier`, `base_risk_pct`, `min_trade_qty`

### üîπ –ë–ª–æ–∫ 4: Telegram –∏ –∫–æ–º–∞–Ω–¥—ã

-   `/summary`, `/pnl_today`, `/growth`, `/goal`, `/debugpanel`, `/riskstatus`, `/runtime` –∏ –¥—Ä.
-   –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã: –∏—Å–ø–æ–ª—å–∑—É—é—Ç TP_LOG_FILE, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è (`Date`, `TP1 Hit`, `SL Hit`)
-   –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ TP1-hit, TP-touch, fallback, soft-exit
-   fallback Telegram –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ –∫–æ–º–∞–Ω–¥–∞—Ö

### üîπ –ë–ª–æ–∫ 5: TP-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è

-   `evaluate_best_config(...)` —Å—á–∏—Ç–∞–µ—Ç TP1/2/SL hits, winrate
-   –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `_update_config_tp(...)`
-   Telegram-–æ—Ç—á—ë—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ/–Ω–æ–≤—ã–µ TP —É—Ä–æ–≤–Ω–∏, winrate

---

## üõ† –§–∏–∫—Å—ã –≤–Ω–µ–¥—Ä–µ–Ω—ã (–Ω–µ —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∏)

-   `main.py` ‚Üí —É–¥–∞–ª—ë–Ω —Ä—É—á–Ω–æ–π CSV header, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ensure_log_exists()` ‚úÖ
-   `record_trade_result(...)` ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω—ã exit_reason, TP-—Ö–∏—Ç—ã, Telegram ‚úÖ
-   `log_trade_result(...)` ‚Üí –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ NaN –∑–∞—â–∏—Ç–∞, –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, TP1/TP2/SL/commission ‚úÖ
-   `tp_logger.py` ‚Üí 18 –ø–æ–ª–µ–π, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫, today_pnl —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
-   `tp_optimizer.py` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TP_LOG_FILE, —Å—á–∏—Ç–∞–µ—Ç TP/SL/Net PnL ‚úÖ
-   `stats.py` ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—á–∏—Ç–∞–µ—Ç daily/weekly PnL, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Date ‚úÖ
-   `telegram_commands.py` ‚Üí `/summary`, `/pnl_today`, `/goal` –æ–±–Ω–æ–≤–ª–µ–Ω—ã: `.sum()` –ø–æ bool, TP_LOG_FILE ‚úÖ
-   `entry_logger.py` ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç TP1 price, TP1 share –∏–∑ config, commission, expected_profit ‚úÖ
-   `missed_tracker.py` ‚Üí –∏—Å–ø—Ä–∞–≤–ª–µ–Ω `.append` ‚Üí `.append()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–∞ ‚úÖ

---

## üîÑ ToDo –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

| –ë–ª–æ–∫                                   | –í–æ–∑–º–æ–∂–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ                                                |
| -------------------------------------- | ------------------------------------------------------------------ |
| ENV-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ                    | –î–æ–±–∞–≤–∏—Ç—å `--config`, `--data-dir` –≤ `main.py` —á–µ—Ä–µ–∑ argparse       |
| WebSocket –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥                   | –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å mark price –¥–ª—è ultra-fast TP-touch detection           |
| –¢—Ä–µ–π–ª–∏–Ω–≥ TP —Ä–∞—Å—à–∏—Ä–∏—Ç—å                  | –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–æ–¥–Ω—è—Ç–∏–µ TP2, TP3 –ø—Ä–∏ —Ä–æ—Å—Ç–µ momentum          |
| –ü—Ä–æ–≥–Ω–æ–∑ –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è              | –û—Ü–µ–Ω–∫–∞ "–∂–∏–≤—É—á–µ—Å—Ç–∏" —Å–∏–≥–Ω–∞–ª–∞ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ (avg hold)                   |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è funding rate                | –î–æ–±–∞–≤–∏—Ç—å long/short bias –ø–æ funding rate –∏–ª–∏ CVD (futures only)    |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π TP fallback             | –ï—Å–ª–∏ TP2 –Ω–µ –∏—Å–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ N –º–∏–Ω—É—Ç, –∑–∞–∫—Ä—ã—Ç—å –ø–æ —Ä—ã–Ω–∫—É –¥–æ–ª—é          |
| –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Telegram –æ—Ç—á—ë—Ç—ã         | /risktrend, /exitstats, /entrybreakdown                            |
| –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π `record_trade_result(...)` | –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º (trend/flat), HTF, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–µ–π–ª–∏–Ω–≥–∞, —Ç–∏–ø –≤—Ö–æ–¥–∞ |

---

## üîö –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

–ë–æ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–∞–±–∏–ª–µ–Ω**, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω:

-   –¢–æ—Ä–≥—É–µ—Ç –¥–æ 12 –ø–∞—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
-   –ü–æ–ª–Ω—ã–π Telegram-UI –∏ fallback –ª–æ–≥–∏–∫–∞
-   –í—Ö–æ–¥—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ —Å–∏–ª–µ —Å–∏–≥–Ω–∞–ª–∞ –∏ min_profit
-   –í—ã—Ö–æ–¥—ã –∞–¥–∞–ø—Ç–∏–≤–Ω—ã: step TP, soft-exit, trailing
-   TP-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, TP_LOG –∞–∫—Ç—É–∞–ª–µ–Ω
-   ENV –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞ –ø–æ–¥ –º—É–ª—å—Ç–∏–±–æ—Ç—ã

üìå –¶–µ–ª—å: **\$3‚Äì5/—á–∞—Å –ø—Ä–∏ \$225**, –¥–∞–ª–µ–µ ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ HFT/Scalp/TP-Sniper –±–æ—Ç–æ–≤.
