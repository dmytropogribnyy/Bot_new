–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ for_real_run.md

1. –û–±–∑–æ—Ä
   –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

–¶–µ–ª—å: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ (DRY_RUN = False) –Ω–∞ 15 –º–∏–Ω—É—Ç —Å –¥–µ–ø–æ–∑–∏—Ç–æ–º 44 USD.
–ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫: RISK_PERCENT = 0.01 (1% —Ä–∏—Å–∫–∞, 0.44 USD) –∏ MAX_POSITIONS = 1.
–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É —Ä–∞—Å—á—ë—Ç—É —á–µ—Ä–µ–∑ get_adaptive_risk_percent(balance) –∏ get_max_positions(balance).
–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ª–∏–Ω—Ç–µ—Ä–∞ –≤ utils_core.py.
–û—Ü–µ–Ω–∫–∞:

–¶–µ–ª—å –∏ –ø–æ–¥—Ö–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –Ω–æ –¥–µ–ø–æ–∑–∏—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –±—ã–ª 120.07 USDC (–ø–æ –ª–æ–≥–∞–º), –∞ –Ω–µ 44 USD, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ. –≠—Ç–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å.
RISK_PERCENT = 0.01 –∏ MAX_POSITIONS = 1 –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ MAX_POSITIONS –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º (–æ—Ç–∫—Ä—ã–ª–æ—Å—å –±–æ–ª—å—à–µ –ø–æ–∑–∏—Ü–∏–π), —á—Ç–æ –º—ã —É–∂–µ –æ–±—Å—É–¥–∏–ª–∏.
–ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É —Ä–∞—Å—á—ë—Ç—É ‚Äî —Ö–æ—Ä–æ—à–∞—è –∏–¥–µ—è, –Ω–æ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.
–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ª–∏–Ω—Ç–µ—Ä–∞ ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω–æ, –Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –º—ã –≤—ã—è–≤–∏–ª–∏ –±–æ–ª–µ–µ —Å–µ—Ä—å—ë–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π –∏ –∑–∞–ø–∏—Å—å—é –≤ tp_performance.csv), –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç.
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–£—Ç–æ—á–Ω–∏—Ç—å –¥–µ–ø–æ–∑–∏—Ç (120.07 USDC –≤–º–µ—Å—Ç–æ 44 USD).
–î–æ–±–∞–≤–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å MAX_POSITIONS –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π.
–î–æ–±–∞–≤–∏—Ç—å —à–∞–≥–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –æ—à–∏–±–æ–∫, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ. 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ config.py
–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: RISK_PERCENT = 0.01, MAX_POSITIONS = 1.
–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ get_adaptive_risk_percent(balance) –∏ get_max_positions(balance).
DRY_RUN = False, VERBOSE = True, USE_DYNAMIC_IN_DRY_RUN = True, ADAPTIVE_SCORE_ENABLED = True.
–û—Ü–µ–Ω–∫–∞:

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∞ (RISK_PERCENT = 0.01, MAX_POSITIONS = 1) –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ MAX_POSITIONS –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏.
–§—É–Ω–∫—Ü–∏–∏ get_adaptive_risk_percent –∏ get_max_positions —Ö–æ—Ä–æ—à–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, –Ω–æ –∏—Ö –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å, –ø–æ–∫–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏.
DRY_RUN = False –∏ VERBOSE = True –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∞, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—É—Ç–∏ –∫ TP_LOG_FILE, —Ç–∞–∫ –∫–∞–∫ –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π No such file or directory.
–í —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ –µ—Å—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ: EXPORT_PATH –∏ TP_LOG_FILE –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–∞ (tp.performance.csv vs tp_performance.csv), —á—Ç–æ –≤—ã–∑–≤–∞–ª–æ –æ—à–∏–±–∫–∏.
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–£—Ç–æ—á–Ω–∏—Ç—å –¥–µ–ø–æ–∑–∏—Ç –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ (120.07 USDC).
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—É—Ç–∏ TP_LOG_FILE –≤ config.py.
–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É EXPORT_PATH –∏ TP_LOG_FILE.
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:

python

Copy

# config.py

# --- Timezone & Paths ---

from pathlib import Path
import os

TIMEZONE = pytz.timezone("Europe/Bratislava")
LOG_FILE_PATH = str(Path("bots", "BinanceBot", "telegram_log.txt"))
EXPORT_PATH = str(Path("c:/Bots/BinanceBot/data/tp_performance.csv"))
TP_LOG_FILE = str(Path("c:/Bots/BinanceBot/data/tp_performance.csv"))

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞

if not Path(TP_LOG_FILE).exists():
print(f"Creating TP_LOG_FILE at {TP_LOG_FILE}")
os.makedirs(os.path.dirname(TP_LOG_FILE), exist_ok=True)
with open(TP_LOG_FILE, mode="w", newline="") as file:
writer = csv.writer(file)
writer.writerow(["Date", "Symbol", "Side", "Entry Price", "Exit Price", "Qty", "TP1 Hit", "TP2 Hit", "SL Hit", "PnL (%)", "Result", "Held (min)", "HTF Confirmed", "ATR", "ADX", "BB Width"])

# --- Risk Management ---

AGGRESSIVENESS_THRESHOLD = 0.6
AGGRESSIVE_THRESHOLD = 50
SAFE_THRESHOLD = 10
MIN_NOTIONAL = 5
MAX_HOLD_MINUTES = 90
RISK_DRAWDOWN_THRESHOLD = 5.0

# –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (15 –º–∏–Ω—É—Ç, –¥–µ–ø–æ–∑–∏—Ç 120.07 USDC)

RISK_PERCENT = 0.01 # 1% —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É (–¥–ª—è —Ç–µ—Å—Ç–∞)
MAX_POSITIONS = 1 # –ú–∞–∫—Å–∏–º—É–º 1 —Å–¥–µ–ª–∫–∞

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (–±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞)

def get_adaptive_risk_percent(balance):
"""–†–∞—Å—á–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Ä–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞."""
if balance < 100:
return 0.01 # 1% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ < 100
elif balance < 300:
return 0.02 # 2% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ 100-300
elif balance < 1000:
return 0.03 # 3% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ 300-1000
else:
return 0.05 # 5% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ > 1000

def get_max_positions(balance):
"""–†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ —Å–¥–µ–ª–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞."""
if balance < 100:
return 1 # 1 —Å–¥–µ–ª–∫–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ < 100
elif balance < 300:
return 2 # 2 —Å–¥–µ–ª–∫–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ 100-300
elif balance < 1000:
return 3 # 3 —Å–¥–µ–ª–∫–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ 300-1000
else:
return 5 # 5 —Å–¥–µ–ª–æ–∫ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ > 1000

# --- Mode & Debug ---

DRY_RUN = False # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ
VERBOSE = True # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
USE_DYNAMIC_IN_DRY_RUN = True
ADAPTIVE_SCORE_ENABLED = True 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ utils_core.py
–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

–£–¥–∞–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è get_adaptive_risk_percent –∏–∑ utils_core.py.
–ò–º–ø–æ—Ä—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É, —É–¥–∞–ª—è–µ—Ç—Å—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π RISK_PERCENT.
–§—É–Ω–∫—Ü–∏—è set_leverage_for_symbols –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
–û—Ü–µ–Ω–∫–∞:

–ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ª–∏–Ω—Ç–µ—Ä–∞.
–û–¥–Ω–∞–∫–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –º—ã –Ω–µ —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –≤ utils_core.py, —Ç–∞–∫ —á—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–¥–µ—Å—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –æ–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã. 4. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ symbol_processor.py
–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ MAX_POSITIONS –∏–∑ config.py.
–î–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–∏—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è get_adaptive_risk_percent(balance).
–û—Ü–µ–Ω–∫–∞:

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MAX_POSITIONS –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, —Ç–∞–∫ –∫–∞–∫ –±–æ—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏.
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ get_adaptive_risk_percent(balance) –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–∏—Å–∫–∞ ‚Äî —Ö–æ—Ä–æ—à–∞—è –∏–¥–µ—è, –Ω–æ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –ª—É—á—à–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ RISK_PERCENT, —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –æ–±–∑–æ—Ä–µ.
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∑–∞–º–µ–Ω–∏ get_adaptive_risk_percent(balance) –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ RISK_PERCENT.
–î–æ–±–∞–≤—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–∏ –≤–º–µ—Å—Ç–æ –∫—ç—à–∞.
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:

python

Copy

# symbol_processor.py

from config import DRY_RUN, MIN_NOTIONAL, SL_PERCENT, MAX_POSITIONS, RISK_PERCENT
from core.order_utils import calculate_order_quantity
from core.strategy import fetch_data, should_enter_trade
from core.trade_engine import (
dry_run_positions_count,
get_position_size,
open_positions_count,
open_positions_lock,
)
from utils_logging import log

def process_symbol(symbol, balance, last_trade_times, lock):
try:
with open_positions_lock:
positions = exchange.fetch_positions()
active_positions = sum(1 for pos in positions if float(pos.get("contracts", 0)) != 0)
if active_positions >= MAX_POSITIONS:
log(
f"‚è© Skipping {symbol} ‚Äî max open positions ({MAX_POSITIONS}) reached (current: {active_positions})",
level="DEBUG",
)
return None

            if get_position_size(symbol) > 0:
                log(f"‚è© Skipping {symbol} ‚Äî already in position", level="DEBUG")
                return None

            df = fetch_data(symbol)
            if df is None:
                log(f"‚ö†Ô∏è Skipping {symbol} ‚Äî fetch_data returned None", level="WARNING")
                return None

            result = should_enter_trade(symbol, df, None, last_trade_times, lock)
            if result is None:
                log(f"‚ùå No signal for {symbol}", level="DEBUG")
                return None

            direction, score, is_reentry = result
            entry = df["close"].iloc[-1]
            stop = entry * (1 - SL_PERCENT) if direction == "buy" else entry * (1 + SL_PERCENT)
            qty = calculate_order_quantity(entry, stop, balance, RISK_PERCENT)

            if qty * entry < MIN_NOTIONAL:
                log(f"‚ö†Ô∏è Notional too low for {symbol} ‚Äî skipping", level="WARNING")
                return None

            log(
                f"{symbol} üîç Calculated qty: {qty:.3f}, entry: {entry:.2f}, notional: {qty * entry:.2f}",
                level="DEBUG",
            )

            return {
                "symbol": symbol,
                "direction": direction,
                "qty": qty,
                "entry": entry,
                "score": score,
                "is_reentry": is_reentry,
            }
    except Exception as e:
        log(f"üî• Error in process_symbol for {symbol}: {e}", level="ERROR")
        return None

5. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

–°–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –∫–æ–¥–∞ –∏ tp_performance.csv.
–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å SYMBOLS_ACTIVE —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, BTC/USDC, ETH/USDC).
–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –Ω–∞ 15 –º–∏–Ω—É—Ç –∏ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏.
–û—Ü–µ–Ω–∫–∞:

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —à–∞–≥–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –æ—à–∏–±–æ–∫, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ /stop, /panic, –∏ –∑–∞–ø–∏—Å—å –≤ tp_performance.csv).
–ù–µ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º.
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–î–æ–±–∞–≤–∏—Ç—å —à–∞–≥ –ø–æ –∑–∞–∫—Ä—ã—Ç–∏—é –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º.
–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–±–ª–µ–º —Å /stop, /panic, –∏ –∑–∞–ø–∏—Å—å—é —Å–¥–µ–ª–æ–∫.
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞ –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ data/tp_performance.csv.
–ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ /panic YES –∏–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Binance, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞.
–ò–∑–º–µ–Ω–∏—Ç–µ SYMBOLS_ACTIVE –≤ config.py, –æ—Å—Ç–∞–≤–∏–≤ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø–∞—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, BTC/USDC, ETH/USDC) –¥–ª—è —Ç–µ—Å—Ç–∞.
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ (DRY_RUN = False) –Ω–∞ 15 –º–∏–Ω—É—Ç:
–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ (telegram_log.txt) –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram.
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–∞ –æ–±—ä—ë–º–∞ —Å–¥–µ–ª–∫–∏ (qty), –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–µ—á–∞ (¬´Leverage set for all symbols¬ª), –∏ —Ä–∞–±–æ—Ç—É –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ (TP1, SL, Breakeven, Trailing Stop).
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã /stop –∏ /panic YES –∑–∞–∫—Ä—ã–≤–∞—é—Ç –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ª–∏ —Å–¥–µ–ª–∫–∏ –≤ tp_performance.csv. 6. –î–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞
–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏, tp_performance.csv, –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram.
–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏.
–û—Ü–µ–Ω–∫–∞:

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–î–æ–±–∞–≤–∏—Ç—å —à–∞–≥ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –≤—Å–µ—Ö –æ—à–∏–±–æ–∫, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –≤ —Ç–µ—Å—Ç–µ.
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏, —Ñ–∞–π–ª—ã tp_performance.csv, –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram.
–£—Å—Ç—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ –æ—à–∏–±–∫–∏, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–±–ª–µ–º—ã —Å /stop, /panic, –∑–∞–ø–∏—Å—å—é –≤ tp_performance.csv, –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º MAX_POSITIONS).
–ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (RISK_PERCENT –∏ MAX_POSITIONS) –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–π get_adaptive_risk_percent(balance) –∏ get_max_positions(balance).
–ò—Ç–æ–≥–æ–≤—ã–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç for_real_run.md
markdown

Copy

# –§–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥—É –∫ –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

## 1. –û–±–∑–æ—Ä

–¶–µ–ª—å ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ (`DRY_RUN = False`) –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç —Å –¥–µ–ø–æ–∑–∏—Ç–æ–º 120.07 USDC —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫–æ–º, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏. –ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –≤–∞–∂–Ω–æ:

- –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫ –Ω–∞ —Ç–µ—Å—Ç–µ: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å `RISK_PERCENT = 0.01` (1% —Ä–∏—Å–∫–∞, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç 1.20 USDC –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ 120.07 USDC) –∏ `MAX_POSITIONS = 1`.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `DRY_RUN = False` –∏ `VERBOSE = True` –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –∑–∞–º–µ–Ω–∏—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏–∏ `get_adaptive_risk_percent(balance)` –∏ `get_max_positions(balance)`.
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ª–∏–Ω—Ç–µ—Ä–∞ (ruff) –≤ `utils_core.py`, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏.
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã `/stop` –∏ `/panic YES` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—é—Ç –ø–æ–∑–∏—Ü–∏–∏.
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–¥–µ–ª–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `tp_performance.csv`.

## 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ config.py

–í–Ω–µ—Å–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —Ç–µ—Å—Ç–∞:

```python
# config.py

# --- Timezone & Paths ---
from pathlib import Path
import os

TIMEZONE = pytz.timezone("Europe/Bratislava")
LOG_FILE_PATH = str(Path("bots", "BinanceBot", "telegram_log.txt"))
EXPORT_PATH = str(Path("c:/Bots/BinanceBot/data/tp_performance.csv"))
TP_LOG_FILE = str(Path("c:/Bots/BinanceBot/data/tp_performance.csv"))

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
if not Path(TP_LOG_FILE).exists():
    print(f"Creating TP_LOG_FILE at {TP_LOG_FILE}")
    os.makedirs(os.path.dirname(TP_LOG_FILE), exist_ok=True)
    with open(TP_LOG_FILE, mode="w", newline="") as file:
        writer = csv.writer(file)
        writer.writerow(["Date", "Symbol", "Side", "Entry Price", "Exit Price", "Qty", "TP1 Hit", "TP2 Hit", "SL Hit", "PnL (%)", "Result", "Held (min)", "HTF Confirmed", "ATR", "ADX", "BB Width"])

# --- Risk Management ---
AGGRESSIVENESS_THRESHOLD = 0.6
AGGRESSIVE_THRESHOLD = 50
SAFE_THRESHOLD = 10
MIN_NOTIONAL = 5
MAX_HOLD_MINUTES = 90
RISK_DRAWDOWN_THRESHOLD = 5.0

# –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (15 –º–∏–Ω—É—Ç, –¥–µ–ø–æ–∑–∏—Ç 120.07 USDC)
RISK_PERCENT = 0.01  # 1% —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É (–¥–ª—è —Ç–µ—Å—Ç–∞)
MAX_POSITIONS = 1    # –ú–∞–∫—Å–∏–º—É–º 1 —Å–¥–µ–ª–∫–∞

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (–±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞)
def get_adaptive_risk_percent(balance):
    """–†–∞—Å—á–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Ä–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞."""
    if balance < 100:
        return 0.01  # 1% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ < 100
    elif balance < 300:
        return 0.02  # 2% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ 100-300
    elif balance < 1000:
        return 0.03  # 3% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ 300-1000
    else:
        return 0.05  # 5% –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ > 1000

def get_max_positions(balance):
    """–†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ —Å–¥–µ–ª–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–∞–Ω—Å–∞."""
    if balance < 100:
        return 1  # 1 —Å–¥–µ–ª–∫–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ < 100
    elif balance < 300:
        return 2  # 2 —Å–¥–µ–ª–∫–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ 100-300
    elif balance < 1000:
        return 3  # 3 —Å–¥–µ–ª–∫–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ 300-1000
    else:
        return 5  # 5 —Å–¥–µ–ª–æ–∫ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ > 1000

# --- Mode & Debug ---
DRY_RUN = False  # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ
VERBOSE = True   # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
USE_DYNAMIC_IN_DRY_RUN = True
ADAPTIVE_SCORE_ENABLED = True
3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ utils_core.py
–ß—Ç–æ–±—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ª–∏–Ω—Ç–µ—Ä–∞ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ä–∏—Å–∫–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

–£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é —Ñ—É–Ω–∫—Ü–∏–∏ get_adaptive_risk_percent –∏–∑ utils_core.py, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –∂—ë—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
–û—Ç—Å–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–º–ø–æ—Ä—Ç—ã –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É –∏ —É–¥–∞–ª–∏—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç RISK_PERCENT. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ config.py.
–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏—è set_leverage_for_symbols –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

python

Copy
# utils_core.py

import json
import os
import time
from datetime import datetime
from threading import Lock

from config import exchange, get_adaptive_risk_percent, LEVERAGE_MAP, SYMBOLS_ACTIVE
from utils_logging import log

def set_leverage_for_symbols():
    for symbol in SYMBOLS_ACTIVE:
        leverage = LEVERAGE_MAP.get(symbol, 5)
        safe_call_retry(
            exchange.set_leverage,
            leverage,
            symbol,
            tries=3,
            delay=1,
            label=f"set_leverage {symbol}",
        )
    log("Leverage set for all symbols", level="INFO")
4. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ symbol_processor.py
–í —Ñ–∞–π–ª–µ symbol_processor.py –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ RISK_PERCENT –¥–ª—è —Ç–µ—Å—Ç–∞ –≤–º–µ—Å—Ç–æ get_adaptive_risk_percent(balance), —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫. –¢–∞–∫–∂–µ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–∏ –≤–º–µ—Å—Ç–æ –∫—ç—à–∞:

python

Copy
# symbol_processor.py

from config import DRY_RUN, MIN_NOTIONAL, SL_PERCENT, MAX_POSITIONS, RISK_PERCENT
from core.order_utils import calculate_order_quantity
from core.strategy import fetch_data, should_enter_trade
from core.trade_engine import (
    dry_run_positions_count,
    get_position_size,
    open_positions_count,
    open_positions_lock,
)
from utils_logging import log

def process_symbol(symbol, balance, last_trade_times, lock):
    try:
        with open_positions_lock:
            positions = exchange.fetch_positions()
            active_positions = sum(1 for pos in positions if float(pos.get("contracts", 0)) != 0)
            if active_positions >= MAX_POSITIONS:
                log(
                    f"‚è© Skipping {symbol} ‚Äî max open positions ({MAX_POSITIONS}) reached (current: {active_positions})",
                    level="DEBUG",
                )
                return None

            if get_position_size(symbol) > 0:
                log(f"‚è© Skipping {symbol} ‚Äî already in position", level="DEBUG")
                return None

            df = fetch_data(symbol)
            if df is None:
                log(f"‚ö†Ô∏è Skipping {symbol} ‚Äî fetch_data returned None", level="WARNING")
                return None

            result = should_enter_trade(symbol, df, None, last_trade_times, lock)
            if result is None:
                log(f"‚ùå No signal for {symbol}", level="DEBUG")
                return None

            direction, score, is_reentry = result
            entry = df["close"].iloc[-1]
            stop = entry * (1 - SL_PERCENT) if direction == "buy" else entry * (1 + SL_PERCENT)
            qty = calculate_order_quantity(entry, stop, balance, RISK_PERCENT)

            if qty * entry < MIN_NOTIONAL:
                log(f"‚ö†Ô∏è Notional too low for {symbol} ‚Äî skipping", level="WARNING")
                return None

            log(
                f"{symbol} üîç Calculated qty: {qty:.3f}, entry: {entry:.2f}, notional: {qty * entry:.2f}",
                level="DEBUG",
            )

            return {
                "symbol": symbol,
                "direction": direction,
                "qty": qty,
                "entry": entry,
                "score": score,
                "is_reentry": is_reentry,
            }
    except Exception as e:
        log(f"üî• Error in process_symbol for {symbol}: {e}", level="ERROR")
        return None
5. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞ –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ data/tp_performance.csv, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º.
–ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ /panic YES –∏–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Binance, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞.
–ò–∑–º–µ–Ω–∏—Ç–µ SYMBOLS_ACTIVE –≤ config.py, –æ—Å—Ç–∞–≤–∏–≤ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø–∞—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, BTC/USDC, ETH/USDC) –¥–ª—è —Ç–µ—Å—Ç–∞.
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ (DRY_RUN = False) –Ω–∞ 15 –º–∏–Ω—É—Ç:
–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ (telegram_log.txt) –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram.
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–∞ –æ–±—ä—ë–º–∞ —Å–¥–µ–ª–∫–∏ (qty), –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–µ—á–∞ (¬´Leverage set for all symbols¬ª), –∏ —Ä–∞–±–æ—Ç—É –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ (TP1, SL, Breakeven, Trailing Stop).
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã /stop –∏ /panic YES –∑–∞–∫—Ä—ã–≤–∞—é—Ç –ø–æ–∑–∏—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ª–∏ —Å–¥–µ–ª–∫–∏ –≤ tp_performance.csv.
6. –î–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏, —Ñ–∞–π–ª—ã tp_performance.csv, –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram.
–£—Å—Ç—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ –æ—à–∏–±–∫–∏, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–±–ª–µ–º—ã —Å /stop, /panic, –∑–∞–ø–∏—Å—å—é –≤ tp_performance.csv, –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º MAX_POSITIONS).
–ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (RISK_PERCENT –∏ MAX_POSITIONS) –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–π get_adaptive_risk_percent(balance) –∏ get_max_positions(balance). –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –±–æ—Ç—É –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é –±–∞–ª–∞–Ω—Å–∞ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞.
–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã: –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∏—Å–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –∫–æ–¥–∞ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ª–∏–Ω—Ç–µ—Ä–∞ –∏ –¥–∞–ª—å–Ω–µ–π—à–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏. –ï—Å–ª–∏ –≤—Å—ë —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫—É —Ç–µ—Å—Ç–∞.

text

Copy

---

### –ò—Ç–æ–≥
–î–æ–∫—É–º–µ–Ω—Ç `for_real_run.md` –±—ã–ª –æ–±–Ω–æ–≤–ª—ë–Ω —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ. –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- –£—Ç–æ—á–Ω—ë–Ω –¥–µ–ø–æ–∑–∏—Ç (120.07 USDC –≤–º–µ—Å—Ç–æ 44 USD).
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–∏ –∫ `tp_performance.csv` –≤ `config.py`.
- –í `symbol_processor.py` –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `RISK_PERCENT` –≤–º–µ—Å—Ç–æ `get_adaptive_risk_percent` –¥–ª—è —Ç–µ—Å—Ç–∞.
- –î–æ–±–∞–≤–ª–µ–Ω—ã —à–∞–≥–∏ –ø–æ –∑–∞–∫—Ä—ã—Ç–∏—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É –ø—Ä–æ–±–ª–µ–º —Å `/stop`, `/panic`, –∏ –∑–∞–ø–∏—Å—å—é —Å–¥–µ–ª–æ–∫.
- –£—Ç–æ—á–Ω–µ–Ω—ã –¥–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫.

–¢–µ–ø–µ—Ä—å –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ü—Ä–∏–º–µ–Ω–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ–¥–∏ —Ç–µ—Å—Ç, —Å–ª–µ–¥—É—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º —à–∞–≥–∞–º. –ù–∞–ø–∏—à–∏, –∫–∞–∫ –≤—Å—ë –ø—Ä–æ—à–ª–æ! üòä
```
