# BinanceBot ‚Äî LIGHT TODO v1.6.3-next [Priority 0: –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å]

–≠—Ç–æ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –¥–ª—è —Ñ–∞–∑—ã Priority 0, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞ –ø–µ—Ä–µ–¥ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

---

## Priority 0 ‚Äî –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é—â–∏–π –±–ª–æ–∫) ‚úÖ

### 1. –í–Ω–µ–¥—Ä–∏—Ç—å safe_call_retry

- **–¶–µ–ª—å:** –£–≤–µ–ª–∏—á–∏—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –≤—ã–∑–æ–≤–æ–≤ Binance API –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–±–æ—è–º.
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –§—É–Ω–∫—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `utils_core.py` –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤:
  - `trade_engine.py` (fetch_ticker, create_limit_order, create_order, fetch_ohlcv)
  - `strategy.py` (fetch_data)
  - `pair_selector.py` (load_markets, fetch_ohlcv)
  - `binance_api.py` (fetch_balance, fetch_ticker –∏ —Ç.–¥.)

### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è last_trade_info —á–µ—Ä–µ–∑ TradeInfoManager

- **–¶–µ–ª—å:** –ò—Å–∫–ª—é—á–∏—Ç—å race conditions –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–¥–µ–ª–∫–∞—Ö.
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å TradeInfoManager –≤ `trade_engine.py` —Å –º–µ—Ç–æ–¥–∞–º–∏ `add_trade`, `get_trade`, `update_trade` –∏ `remove_trade`. –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ last_trade_info –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ trade_manager.

### 3. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ polling (DRY_RUN vs REAL_RUN)

- **–¶–µ–ª—å:** –°–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –∏ —à—É–º –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.
- **–°—Ç–∞—Ç—É—Å:**
  - `telegram_handler.py`: –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–ø—Ä–æ—Å–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ `time.sleep(60 if DRY_RUN else 3)`.
  - `ip_monitor.py`: –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ IP –≤—ã—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ `check_interval = 120 if DRY_RUN else 30 * 60`.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –í engine_controller.py –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ª–æ–≥–æ–≤ ¬´Checking {symbol}¬ª –∏ ¬´Balance for cycle¬ª (–Ω–µ —á–∞—â–µ 5 –º–∏–Ω—É—Ç).

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

BinanceBot ‚Äî LIGHT TODO v1.6.3-next
Priority 0 ‚Äî –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é—â–∏–π –±–ª–æ–∫) ‚úÖ
–í–Ω–µ–¥—Ä–∏—Ç—å safe_call_retry

–¶–µ–ª—å: –£–≤–µ–ª–∏—á–∏—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –≤—ã–∑–æ–≤–æ–≤ Binance API –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–±–æ—è–º.

–°—Ç–∞—Ç—É—Å: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ utils_core.py –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤:

trade_engine.py (fetch_ticker, create_limit_order, create_order, fetch_ohlcv)

strategy.py (fetch_data)

pair_selector.py (load_markets, fetch_ohlcv)

binance_api.py (fetch_balance, fetch_ticker –∏ —Ç.–¥.)

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è last_trade_info —á–µ—Ä–µ–∑ TradeInfoManager

–¶–µ–ª—å: –ò—Å–∫–ª—é—á–∏—Ç—å race conditions –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–¥–µ–ª–∫–∞—Ö.

–°—Ç–∞—Ç—É—Å: ‚úÖ –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å TradeInfoManager –≤ trade_engine.py —Å –º–µ—Ç–æ–¥–∞–º–∏ add_trade, get_trade, update_trade –∏ remove_trade. –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–¥–µ–ª–∫–∞—Ö –∑–∞–º–µ–Ω–µ–Ω—ã –≤—ã–∑–æ–≤–∞–º–∏ —á–µ—Ä–µ–∑ trade_manager.

–ê–¥–∞–ø—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ polling (DRY_RUN vs REAL_RUN)

–¶–µ–ª—å: –°–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –∏ —à—É–º –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.

–°—Ç–∞—Ç—É—Å:

–í telegram_handler.py: –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–ø—Ä–æ—Å–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ time.sleep(60 if DRY_RUN else 3).

–í ip_monitor.py: –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ IP –≤—ã—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ check_interval = 120 if DRY_RUN else 30 \* 60.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –í engine_controller.py –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ª–æ–≥–æ–≤ ¬´Checking {symbol}¬ª –∏ ¬´Balance for cycle¬ª (–Ω–µ —á–∞—â–µ 5 –º–∏–Ω—É—Ç).

Priority 1 ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—Ö–æ–¥–∞ –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è ‚úÖ
‚ôªÔ∏è Smart Re-entry Logic

–¶–µ–ª—å: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –ø–æ —Ç–æ–π –∂–µ –ø–∞—Ä–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–∏–ª—å–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º cooldown –∏ score).

–°—Ç–∞—Ç—É—Å: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ strategy.py (—Ñ—É–Ω–∫—Ü–∏—è should_enter_trade) –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ trade_engine.py. –õ–æ–≥–∏–∫–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç:

–í—Ö–æ–¥ –ø–æ re-entry, –µ—Å–ª–∏ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞ –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–æ—à–ª–æ –º–µ–Ω–µ–µ 30 –º–∏–Ω—É—Ç –∏ –Ω–æ–≤—ã–π score –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ (score > 4 –∏–ª–∏ —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 1.5+ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤—Ö–æ–¥–æ–º).

–†–µ–∂–∏–º DRY_RUN –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç re-entry, —Ö–æ—Ç—è –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏—Ö –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ—Ä–¥–µ—Ä–æ–≤.

üîÑ Soft Exit / Partial TP Optimization

–¶–µ–ª—å: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≤—ã—Ö–æ–¥, –∫–æ–≥–¥–∞ TP1 –ø–æ—á—Ç–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, —á—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç—å –ø—Ä–∏–±—ã–ª–∏, –∑–∞–∫—Ä—ã–≤–∞—è —á–∞—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏.

–°—Ç–∞—Ç—É—Å: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. –í trade_engine.py –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è run_soft_exit, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç 50% –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 90% –æ—Ç TP1 (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SOFT_EXIT_THRESHOLD –∏ SOFT_EXIT_SHARE –≤ config.py). –í —Å–¥–µ–ª–∫–µ –∏–º–µ–µ—Ç—Å—è —Ñ–ª–∞–≥ soft_exit_hit –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.

üìä Auto TP/SL based on market regime

–¶–µ–ª—å: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ TP1, TP2 –∏ SL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (flat vs trending).

–°—Ç–∞—Ç—É—Å: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è get_market_regime –≤ trade_engine.py, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º (trend, flat –∏–ª–∏ neutral) –Ω–∞ –æ—Å–Ω–æ–≤–µ ADX.

–í —Ñ—É–Ω–∫—Ü–∏–∏ enter_trade TP/SL –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è:

–í —Ä–µ–∂–∏–º–µ "flat" (–∫–æ–≥–¥–∞ ADX < ADX_FLAT_THRESHOLD) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç FLAT_ADJUSTMENT (0.7).

–í —Ä–µ–∂–∏–º–µ "trend" (–∫–æ–≥–¥–∞ ADX > ADX_TREND_THRESHOLD) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç TREND_ADJUSTMENT (1.3).

–°–æ–æ–±—â–µ–Ω–∏—è –æ–± –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ TP/SL –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´Adjusted TP/SL for BTC/USDC: trend regime (x1.3 for TP2/SL)¬ª).

–í —Ç–µ–∫—É—â–µ–º config.py —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ä–∞–±–æ—Ç—É —Ñ—É–Ω–∫—Ü–∏–∏:

python
Copy
AUTO_TP_SL_ENABLED = True
FLAT_ADJUSTMENT = 0.7
TREND_ADJUSTMENT = 1.3
ADX_TREND_THRESHOLD = 20
ADX_FLAT_THRESHOLD = 15
–ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è ADX –¥–ª—è —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 20‚Äì25, —Ä–µ–∂–∏–º –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –∫–∞–∫ "neutral" (–±–µ–∑ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ TP/SL). –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ (20/15) –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–∏—Å—Ç–µ–º–µ —á–∞—â–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

### Priority 2 ‚Äî –£–ª—É—á—à–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞

- –ü–µ—Ä–µ–¥–∞—á–∞ relax_factor –≤ score_evaluator.py, —É–ª—É—á—à–µ–Ω–∏–µ calculate_score() –∏ –∞–Ω–∞–ª–∏–∑ –æ—Ç–∫–∞–∑–æ–≤ —Å–¥–µ–ª–æ–∫.

### Priority 3 ‚Äî UI, –æ—Ç–ª–∞–¥–∫–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–≤–µ–¥–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã `/errors`, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `/summary`, –≤—ã–≤–æ–¥ —Ç–µ–∫—É—â–µ–π –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—á–µ–µ.

### Maintenance / Housekeeping

- –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ LIGHT_TODO_v1.6.2.md –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ README/SUMMARY.md.

---

**–ò—Ç–æ–≥:** Priority 0 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ (safe_call_retry, TradeInfoManager, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã polling, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è) –≤–Ω–µ–¥—Ä–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.

---

–ß—Ç–æ –¥–∞–ª—å—à–µ?
–ü—Ä–µ–¥–ª–∞–≥–∞—é –ø–µ—Ä–µ–π—Ç–∏ –∫ Priority 1: –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ Smart Re-entry Logic. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É (–≤ strategy.py) –∏, –≤–æ–∑–º–æ–∂–Ω–æ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∞–º–∏ (–≤ trade_engine.py).

–ï—Å–ª–∏ –≤—Å–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç, –º–æ–∂–µ–º –æ—Ç–º–µ—Ç–∏—Ç—å Priority 0 –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–µ, –∏ —è –≥–æ—Ç–æ–≤ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ–±—Å—É–¥–∏—Ç—å –ø–ª–∞–Ω –¥–ª—è Priority 1.
