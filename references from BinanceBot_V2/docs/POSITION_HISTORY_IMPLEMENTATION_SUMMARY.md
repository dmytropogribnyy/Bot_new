# Position History Reporter - –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üéØ –¶–µ–ª—å

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ–π —Å–≤–æ–¥–∫–∏ –ø–æ–∑–∏—Ü–∏–π –∏–∑ Binance API –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –±–æ—Ç–∞, —á—Ç–æ–±—ã –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ä–∞–Ω—É.

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å `core/position_history_reporter.py`

- **PositionHistoryReporter** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
- **TradePosition** - dataclass –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∑–∏—Ü–∏–∏
- **PositionSummary** - dataclass –¥–ª—è —Å–≤–æ–¥–∫–∏ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º

### 2. API –º–µ—Ç–æ–¥—ã

- `get_user_trades()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫
- `get_position_risk()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∑–∏—Ü–∏—è—Ö
- `get_income_history()` - –∏—Å—Ç–æ—Ä–∏—è –¥–æ—Ö–æ–¥–æ–≤ (funding fees)
- `get_account_info()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ

### 3. –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–¥–µ–ª–æ–∫ –≤ –ø–æ–∑–∏—Ü–∏–∏ (–≤—Ö–æ–¥/–≤—ã—Ö–æ–¥)
- –†–∞—Å—á–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ PnL —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π
- –ê–Ω–∞–ª–∏–∑ –ø–æ —Å–∏–º–≤–æ–ª–∞–º
- –£—á–µ—Ç funding fees

### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤

- `generate_position_report()` - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
- `format_position_report()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—ã–≤–æ–¥–∞
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –±–æ—Ç–æ–º

- **main.py** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
- **telegram/command_handlers.py** - –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è Telegram
- **telegram/telegram_bot.py** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã

### 6. Telegram –∫–æ–º–∞–Ω–¥–∞

- `/position_history [hours]` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ —á–µ—Ä–µ–∑ Telegram
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ (1-168 —á–∞—Å–æ–≤)

### 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- `test_position_history.py` - –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
- `scripts/test_position_report.py` - –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö API –º–µ—Ç–æ–¥–æ–≤

### 8. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/position_history_reporter.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –û–ø–∏—Å–∞–Ω–∏–µ API –º–µ—Ç–æ–¥–æ–≤

## üìä –ü–æ–ª–µ–∑–Ω—ã–µ Binance API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

1. **GET /fapi/v1/userTrades** - —Å–¥–µ–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **GET /fapi/v1/positionRisk** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∑–∏—Ü–∏—è—Ö
3. **GET /fapi/v1/income** - –∏—Å—Ç–æ—Ä–∏—è –¥–æ—Ö–æ–¥–æ–≤
4. **GET /fapi/v1/account** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
- Graceful fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API –≤—ã–∑–æ–≤–æ–≤
- Rate limiting —á–µ—Ä–µ–∑ exchange_client
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–µ–π –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

## üìã –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ—Ä—Ç–µ—Ä–∞
reporter = PositionHistoryReporter(config, logger)
await reporter.initialize()

# –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
summary, positions = await reporter.generate_position_report(hours=24)

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
print(f"–°–¥–µ–ª–æ–∫: {summary.total_trades}")
print(f"PnL: ${summary.total_pnl:.2f}")
print(f"–í–∏–Ω—Ä–µ–π—Ç: {summary.win_rate:.1%}")
print(f"–ß–∏—Å—Ç—ã–π PnL: ${summary.net_pnl:.2f}")

# –û—á–∏—Å—Ç–∫–∞
await reporter.cleanup()
```

## üöÄ Telegram –∫–æ–º–∞–Ω–¥–∞

```
/position_history 24
```

–í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–≤–æ–¥–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞.

## üìà –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞ (Ctrl+C, SIGTERM) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
2. –ü–æ–ª—É—á–∞–µ—Ç—Å—è —Å–≤–æ–¥–∫–∞ –ø–æ–∑–∏—Ü–∏–π –∏–∑ API
3. –í—ã–≤–æ–¥–∏—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –±–æ—Ç –º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ä–∞–Ω—É, –ø–æ–ª—É—á–∞—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Binance API, –≤–∫–ª—é—á–∞—è:

- ‚úÖ –¢–æ—á–Ω—ã–π PnL –ø–æ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –£—á–µ—Ç –≤—Å–µ—Ö –∫–æ–º–∏—Å—Å–∏–π –∏ funding fees
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –ø–æ —Å–∏–º–≤–æ–ª–∞–º
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤! üéâ
